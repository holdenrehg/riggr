/* Part of the Riggr SPA framework <https://github.com/Fluidbyte/Riggr> and released under the MIT license. This notice must remain intact. */
!function(a,b){"function"==typeof define&&define.amd?define(["metric"],b):"object"==typeof exports?module.exports=b(require("metric")):a.router=b(a.metric)}(this,function(a){var b=function(){var a=this;window.onhashchange=function(){a.process()},window.onload=function(){a.process()}};b.prototype.routes={},b.prototype.history=[],b.prototype.process=function(){var b,c,d,e=this,f=window.location.hash.replace("#","").replace(/^\/|\/$/g,""),g=!1,h=[];f="/"!==f.substr(0)?"/"+f:f,b=e.match(),c=b.route,d=b.args;var i=function(){"function"==typeof h.before?h.before(function(a){a&&h.load?(h.load.apply(this,d),e.history.push({matcher:c,fragment:f})):e.history&&e.history.length&&e.go(e.history[e.history.length-1].fragment)}):"function"==typeof h.load&&(h.load.apply(this,d),e.history.push({matcher:c,fragment:f})),"function"!=typeof h.load||h.before||(h.load.apply(this,d),e.history.push({matcher:c,fragment:f}))};0!==e.history.length&&(g=e.routes[e.history[e.history.length-1].matcher]),h=e.routes[c],g&&"function"==typeof g.unload&&g.unload.apply(this),g&&a.view.unload(),h&&"function"==typeof h.beforeAppRoute?h.beforeAppRoute(function(a){a&&i()}):h&&i()},b.prototype.match=function(){var a,b,c,d,e=this,f=window.location.hash.replace("#","").replace(/^\/|\/$/g,""),g=[],h=!1;if(f="/"!==f.substr(0)?"/"+f:f,"/"===f&&e.routes.hasOwnProperty("/"))h={route:"/",args:null};else for(b in e.routes)if(a=f.match(new RegExp(b.replace(/:[^\s/]+/g,"([\\w-]+)"))),null!==a&&a[0]===f){if(g=[],a.length>1)for(c=1,d=a.length;d>c;c++)g.push(a[c]);h={route:b,args:g},e.current=b}return h||e.routes.hasOwnProperty("/404")&&(h={route:"/404",args:[f]}),h},b.prototype.reload=function(){this.process()},b.prototype.on=function(a,b){if(this.routes[a]={},b&&"function"==typeof b)this.routes[a].before=!1,this.routes[a].load=b,this.routes[a].unload=!1;else{if(!b||"object"!=typeof b)throw"Error creating route";this.routes[a].beforeAppRoute=b.beforeAppRoute?b.beforeAppRoute:!1,this.routes[a].before=b.before?b.before:!1,this.routes[a].load=b.load?b.load:!1,this.routes[a].unload=b.unload?b.unload:!1}},b.prototype.go=function(a){var b,c=window.location,d=c.pathname.replace(/[^\/]$/,"$&"),e=this;b=a.length?d+c.search+"#"+a:d+c.search,history.pushState?(history.pushState(null,document.title,b),e.process()):(c.replace(d+b),e.process())};var c=new b;return c});